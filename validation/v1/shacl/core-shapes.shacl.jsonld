{
  "@context": {
    "rdf": "http://www.w3.org/1999/02/22-rdf-syntax-ns#",
    "rdfs": "http://www.w3.org/2000/01/rdf-schema#",
    "sh": "http://www.w3.org/ns/shacl#",
    "xsd": "http://www.w3.org/2001/XMLSchema#",
    "dppk": "https://dpp-keystone.org/spec/v1/terms#",
    "dppkval": "https://dpp-keystone.org/validation/v1/shacl/"
  },
  "@id": "dppkval:CoreShapes",
  "@type": "sh:ShapesGraph",
  
  "@graph": [
    // ==================================================================
    // Shape: Organization
    // Validates basic requirements for organizational data.
    // ==================================================================
    {
      "@id": "dppkval:OrganizationShape",
      "@type": "sh:NodeShape",
      "sh:targetClass": { "@id": "dppk:Organization" },
      "sh:property": [
        {
          // Must have an organization name.
          "sh:path": { "@id": "dppk:organizationName" },
          "sh:minCount": 1,
          "sh:severity": { "@id": "sh:Violation" },
          "sh:message": "Organization must have a name (dppk:organizationName)."
        },
        {
          // If GLN is present, it must be a 13-digit number (simple validation).
          "sh:path": { "@id": "dppk:gln" },
          "sh:pattern": "^[0-9]{13}$",
          "sh:message": "GLN (dppk:gln) must be a 13-digit number."
        },
        {
           // If LEI is present, it must be a 20-character alphanumeric string.
           "sh:path": { "@id": "dppk:leiCode" },
           "sh:pattern": "^[A-Z0-9]{20}$",
           "sh:message": "LEI Code (dppk:leiCode) must be a 20-character alphanumeric string."
        }
      ]
    },

    // ==================================================================
    // Shape: QuantitativeValue
    // Ensures measurements are complete.
    // ==================================================================
    {
        "@id": "dppkval:QuantitativeValueShape",
        "@type": "sh:NodeShape",
        "sh:targetClass": { "@id": "dppk:QuantitativeValue" },
        "sh:property": [
          {
            // Must have a numeric value.
            "sh:path": { "@id": "dppk:value" },
            "sh:minCount": 1,
            "sh:datatype": { "@id": "xsd:decimal" },
            "sh:severity": { "@id": "sh:Violation" },
            "sh:message": "QuantitativeValue must have a numeric value (dppk:value)."
          },
          {
            // Must have a unit code.
            "sh:path": { "@id": "dppk:unitCode" },
            "sh:minCount": 1,
            "sh:severity": { "@id": "sh:Violation" },
            "sh:message": "QuantitativeValue must specify a unitCode (dppk:unitCode), preferably UN/CEFACT."
          }
        ]
    },

    // ==================================================================
    // Shape: DigitalProductPassport (Payload Validation)
    // Validates the core relationships within the DPP payload.
    // ==================================================================
    {
        "@id": "dppkval:DigitalProductPassportShape",
        "@type": "sh:NodeShape",
        "sh:targetClass": { "@id": "dppk:DigitalProductPassport" },
        "sh:property": [
            {
                // Must have a product name.
                "sh:path": { "@id": "dppk:productName" },
                "sh:minCount": 1,
                "sh:severity": { "@id": "sh:Violation" },
                "sh:message": "DPP must have a product name (dppk:productName)."
            },
            {
                // Manufacturer relationship must point to a valid Organization shape.
                "sh:path": { "@id": "dppk:manufacturer" },
                // Ensure the object linked via manufacturer conforms to the OrganizationShape.
                "sh:node": { "@id": "dppkval:OrganizationShape" },
                "sh:message": "The manufacturer must conform to the Organization shape."
            },
            {
                // Economic Operator relationship must point to a valid Organization shape.
                "sh:path": { "@id": "dppk:economicOperator" },
                "sh:node": { "@id": "dppkval:OrganizationShape" },
                "sh:message": "The economicOperator must conform to the Organization shape."
            }
        ]
    },

    // ==================================================================
    // Shape: Certification
    // ==================================================================
    {
        "@id": "dppkval:CertificationShape",
        "@type": "sh:NodeShape",
        "sh:targetClass": { "@id": "dppk:Certification" },
        "sh:property": [
            {
                "sh:path": { "@id": "dppk:certificationStandard" },
                "sh:minCount": 1,
                "sh:message": "Certification must specify the standard or name (dppk:certificationStandard)."
            },
            {
                "sh:path": { "@id": "dppk:certificationIdentification" },
                "sh:minCount": 1,
                "sh:message": "Certification must have an identifier or number (dppk:certificationIdentification)."
            }
        ]
    }
  ]
}
