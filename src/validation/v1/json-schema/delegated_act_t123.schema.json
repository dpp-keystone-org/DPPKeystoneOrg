{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://dpp.europa.eu/schemas/delegated_act_t123.schema.json",
  "title": "Delegated Act T123 - Conditional Requirements for Textile Products",
  "description": "This schema conditionally applies mandatory data attributes for textile products ONLY IF its ID is present in the 'contentSpecificationIds' array.",
  "type": "object",
  "if": {
    "properties": {
      "contentSpecificationIds": {
        "description": "Check if this array contains the ID for the T123 Delegated Act.",
        "type": "array",
        "contains": {
          "const": "delegated_act_t123.schema.json"
        }
      }
    },
    "required": [
      "contentSpecificationIds"
    ]
  },
  "then": {
    "properties": {
      "textileProduct": {
        "description": "Contains the mandatory attributes for the textile product.",
        "type": "object",
        "properties": {
          "fibreComposition": {
            "description": "The composition of the product by fibre type. Unit: Percentage by Mass (%). Standard: EU Regulation 1007/2011.",
            "type": "array",
            "minItems": 1,
            "items": {
              "type": "object",
              "properties": {
                "fibreType": {
                  "type": "string"
                },
                "percentage": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 100
                }
              },
              "required": [
                "fibreType",
                "percentage"
              ]
            }
          },
          "recycledContent": {
            "description": "The total percentage of recycled material in the product. Unit: Percentage by Mass (%). Standards: e.g., Global Recycled Standard (GRS), Recycled Claim Standard (RCS).",
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "material": {
                  "type": "string",
                  "description": "The material for which recycled content is being declared."
                },
                "percentage": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 100
                },
                "verificationStandard": {
                  "type": "string",
                  "description": "The standard used for verification (e.g., GRS, RCS)."
                }
              },
              "required": [
                "material",
                "percentage",
                "verificationStandard"
              ]
            }
          },
          "majorProductionSteps": {
            "description": "The country of major production steps. Unit: ISO 3166-1 alpha-3 Country Code.",
            "type": "array",
            "minItems": 1,
            "items": {
              "type": "object",
              "properties": {
                "step": {
                  "type": "string",
                  "enum": [
                    "Spinning",
                    "Weaving",
                    "Knitting",
                    "Finishing",
                    "Dyeing",
                    "Assembly"
                  ]
                },
                "countryCode": {
                  "type": "string",
                  "pattern": "^[A-Z]{3}$"
                }
              },
              "required": [
                "step",
                "countryCode"
              ]
            }
          },
          "substancesOfConcern": {
            "description": "A declaration of any Substances of Very High Concern (SVHC) present above 0.1% weight by weight. Standard: REACH Regulation (EC) 1907/2006.",
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "substanceName": {
                  "type": "string"
                },
                "casNumber": {
                  "type": "string"
                },
                "concentration": {
                  "type": "number",
                  "minimum": 0.1,
                  "description": "The concentration of the substance. Unit: Percentage by Mass (%)"
                }
              },
              "required": [
                "substanceName",
                "casNumber",
                "concentration"
              ]
            }
          },
          "abrasionResistance": {
            "description": "The durability of the fabric against abrasion. Unit: Number of Rubs/Cycles to breakdown. Standard: ISO 12947 series.",
            "type": "object",
            "properties": {
              "cycles": {
                "type": "integer",
                "minimum": 0
              },
              "testMethod": {
                "type": "string",
                "pattern": "^ISO 12947(-\\d+)?$",
                "description": "The specific part of the ISO 12947 series used for testing."
              }
            },
            "required": [
              "cycles",
              "testMethod"
            ]
          },
          "dimensionalStability": {
            "description": "The percentage a fabric shrinks or grows after washing and drying. Unit: Dimensional Change (%). Standard: ISO 5077.",
            "type": "object",
            "properties": {
              "warpChange": {
                "type": "number",
                "description": "Dimensional change in the warp (length) direction."
              },
              "weftChange": {
                "type": "number",
                "description": "Dimensional change in the weft (width) direction."
              },
              "testMethod": {
                "type": "string",
                "const": "ISO 5077"
              }
            },
            "required": [
              "warpChange",
              "weftChange",
              "testMethod"
            ]
          },
          "colorfastnessToWashing": {
            "description": "The resistance of the color to domestic laundering. Unit: Change in Colour Grade (Scale 1-5, where 5 is best). Standard: ISO 105-C06.",
            "type": "object",
            "properties": {
              "grade": {
                "type": "number",
                "minimum": 1,
                "maximum": 5
              },
              "testMethod": {
                "type": "string",
                "const": "ISO 105-C06"
              }
            },
            "required": [
              "grade",
              "testMethod"
            ]
          },
          "microplasticRelease": {
            "description": "The amount of lint and other particles released during laundering. Unit: Milligrams per kilogram of textile (mg/kg). Standard: ISO 4484-1.",
            "type": "object",
            "properties": {
              "value": {
                "type": "number",
                "minimum": 0
              },
              "testMethod": {
                "type": "string",
                "const": "ISO 4484-1"
              }
            },
            "required": [
              "value",
              "testMethod"
            ]
          },
          "careInstructions": {
            "description": "A sequence of standardized care symbols. Standard: ISO 3758 (GINETEX).",
            "type": "array",
            "minItems": 1,
            "items": {
              "type": "string",
              "description": "A GINETEX symbol identifier."
            }
          }
        },
        "required": [
          "fibreComposition",
          "recycledContent",
          "majorProductionSteps",
          "substancesOfConcern",
          "abrasionResistance",
          "dimensionalStability",
          "colorfastnessToWashing",
          "microplasticRelease",
          "careInstructions"
        ],
        "additionalProperties": true
      },
      "certifications": {
        "description": "A list of certifications applicable to the product.",
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "certificationName": {
              "type": "string",
              "description": "The name of the standard or certification scheme.",
              "example": "GOTS"
            },
            "certificationAuthority": {
              "type": "string",
              "description": "The organization that owns the standard.",
              "example": "Global Organic Textile Standard"
            },
            "certificationId": {
              "type": "string",
              "description": "The number or ID of the certificate."
            },
            "certificationValue": {
              "type": "string",
              "description": "The specific grade or value achieved, if applicable."
            },
            "certificationBodyId": {
              "type": "string",
              "description": "The identifier of the Conformity Assessment Body that issued the certificate."
            },
            "certificationBodyType": {
              "type": "string",
              "const": "CONFORMITY_ASSESSMENT_BODY"
            },
            "certificationStartDate": {
              "type": "string",
              "format": "date"
            },
            "certificationEndDate": {
              "type": "string",
              "format": "date"
            }
          },
          "required": [
            "certificationName",
            "certificationId",
            "certificationAuthority",
            "certificationBodyId"
          ],
          "additionalProperties": true
        }
      }
    },
    "required": [
      "textileProduct"
    ]
  },
  "additionalProperties": true
}