// Minimal CSV Parser Polyfill for offline dev
(function(global) {
    global.Papa = {
        parse: function(file, config) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                // Simple parser: doesn't handle newlines in quotes perfectly, but handles quoted commas
                const rows = text.split(/\r?\n/).filter(r => r.trim() !== '');
                const data = rows.map(row => {
                    // Regex to split by comma, ignoring commas inside quotes
                    return row.split(/,(?=(?:(?:[^""]*\"){2})*[^\"]*$)/).map(val => {
                        val = val.trim();
                        if (val.startsWith('"') && val.endsWith('"')) {
                            // Unescape double quotes
                            return val.slice(1, -1).replace(/""/g, '"');
                        }
                        return val;
                    });
                });
                
                let results = { data: data, meta: {} };
                if (config.header) {
                    const headers = data[0];
                    results.data = data.slice(1).map(row => {
                        let obj = {};
                        headers.forEach((h, i) => {
                            if (h) obj[h] = row[i];
                        });
                        return obj;
                    });
                    results.meta.fields = headers;
                }

                if (config.complete) {
                    config.complete(results);
                }
            };
            if (typeof file === 'string') {
                // If passing string directly
                // Not implementing string parsing for this stub as we use File object
            } else {
                reader.readAsText(file);
            }
        }
    };
})(this || window);
